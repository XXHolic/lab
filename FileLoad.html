<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>FileLoad</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
</head>

<body>
  <form>
    <fieldset>
      <legend>读取进度条文件：</legend>
      <input type="file" id="file6" />
      <!-- <input type="button" value="中断" id="Abort" /> -->
      <p>
        <label>读取进度：</label>
        <progress id="progress2" value="0" max="100"></progress>
      </p>
      <p id="Status"></p>
    </fieldset>
  </form>
  <script type="text/javascript">
  var num = document.getElementById('Status');
  var progress2 = document.getElementById('progress2');
  var input6 = document.getElementById('file6');
  var block = 5 * 1024; // 每次读取10K
  // 当前文件对象
  var file;
  // 当前已读取大小
  var fileLoaded;
  // 文件总大小
  var fileSize;

  // 每次读取一个block
  function readBlob2() {
    var blob;
    if (file.webkitSlice) {
      blob = file.webkitSlice(fileLoaded, fileLoaded + block + 1);
    } else if (file.mozSlice) {
      blob = file.mozSlice(fileLoaded, fileLoaded + block + 1);
    } else if (file.slice) {
      blob = file.slice(fileLoaded, fileLoaded + block + 1);
    } else {
      alert('不支持分段读取！');
      return false;
    }
    reader.readAsBinaryString(blob);
  }
  // 每个blob读取完毕时调用
  function loadHandler2(e) {
    fileLoaded += e.total;
    var percent = fileLoaded / fileSize;
    if (percent < 1) {
      // 继续读取下一块
      console.log(this.result);
      readBlob2();

    } else {
      // 结束
      percent = 1;
      console.log(this.result);
    }
    percent = Math.ceil(percent * 100);
    progress2.setAttribute("value",percent);
    num.innerHTML=percent;
  }

  function fileSelect6(e) {
    file = this.files[0];
    if (!file) {
      alert('文件不能为空！');
      return false;
    }
    fileLoaded = 0;
    fileSize = file.size;
    // bar2.style.display = 'block';
    // 开始读取
    readBlob2();
  }
  var reader = new FileReader();
  // 只需监听onload事件
  reader.onload = loadHandler2;
  input6.onchange = fileSelect6
  </script>
</body>

</html>
